{"appModel":"1.1.1","connections":{},"contrib":[],"description":"","imports":["github.com/project-flogo/flow/activity/subflow","github.com/SteveNY-Tibco/labs-lightcrane-contrib/activity/jsonserializer","github.com/project-flogo/contrib/function/utils","github.com/SteveNY-Tibco/labs-air-contrib/activity/dataselector","github.com/project-flogo/contrib/function/coerce","github.com/SteveNY-Tibco/labs-air-contrib/activity/mqtt","github.com/SteveNY-Tibco/labs-air-contrib/activity/log","github.com/SteveNY-Tibco/labs-air-contrib/trigger/mqtt","github.com/SteveNY-Tibco/labs-lightcrane-contrib/activity/jsondeserializer","github.com/project-flogo/flow","github.com/project-flogo/contrib/activity/actreturn","github.com/SteveNY-Tibco/labs-lightcrane-contrib/activity/mapping","github.com/SteveNY-Tibco/labs-air-contrib/function/air","github.com/project-flogo/contrib/function/string","github.com/project-flogo/contrib/function/array"],"name":"AirPipeline","properties":[{"name":"DataSource_Logging.LogLevel","type":"string","value":"DEBUG"},{"name":"Mqtt.DataSource_IoTMQTT.Broker_URL","type":"string","value":"localhost:1883"},{"name":"DataSource_MQTTTrigger.Deserializer","type":"string","value":"JSON"},{"name":"Mqtt.DataSource_IoTMQTT.KeepAlive","type":"float64","value":30},{"name":"Mqtt.DataSource_IoTMQTT.Store","type":"string","value":":memory:"},{"name":"Mqtt.DataSource_IoTMQTT.CleanSession","type":"boolean","value":true},{"name":"Mqtt.DataSource_IoTMQTT.AutoReconnect","type":"boolean","value":true},{"name":"Mqtt.DataSource_IoTMQTT.Username","type":"string","value":"mqtt_admin"},{"name":"Mqtt.DataSource_IoTMQTT.Password","type":"string","value":"SECRET:kYUiZMH0aoZf65YO/miaUQ=="},{"name":"DataSource_MQTTTrigger.Topic","type":"string","value":"EdgexGatewayData"},{"name":"DataSource_MQTTTrigger.MaximumQOS","type":"float64","value":2},{"name":"DataSource_Data.Gateway","type":"string","value":"\"gateway\""},{"name":"DataSource_Data.DecodePayload","type":"boolean","value":true},{"name":"DataSource_App.ComponentName","type":"string","value":"DataSource"},{"name":"Pipe_0_Logging.LogLevel","type":"string","value":"INFO"},{"name":"Pipe_0_MQTTPub.Topic","type":"string","value":"AIRModelScoredData"},{"name":"Pipe_0_MQTTPub.Qos","type":"float64","value":2},{"name":"Pipe_0_MQTTPub.KeepAlive","type":"float64","value":120},{"name":"Pipe_0_MQTTPub.CleanSession","type":"boolean","value":false},{"name":"Pipe_0_MQTTPub.Retain","type":"boolean","value":false},{"name":"Pipe_0_MQTTPub.Store","type":"string","value":""},{"name":"Mqtt.Pipe_0_IoTMQTT.Broker_URL","type":"string","value":"tcp://a0056dbbadb2f11e99e4c067e42b309c-335014729.us-west-2.elb.amazonaws.com:1883"},{"name":"Mqtt.Pipe_0_IoTMQTT.Username","type":"string","value":"mqtt_admin"},{"name":"Mqtt.Pipe_0_IoTMQTT.Password","type":"string","value":"SECRET:w73f6dRNWmzKm4xSRB0yRg=="},{"name":"Pipe_0_App.ComponentName","type":"string","value":"Pipe_0"},{"name":"App.NotificationListeners","type":"string","value":"[]"},{"name":"Pipe_0_MQTTPub.NotificationData","type":"string","value":"{\"uuid\": \"@f1..id@\",\"created\": \"@f1..origin@\",\"gateway\": \"@f1..gateway@\",\"device\": \"@f1..device@\",\"resource\": \"@f1..name@\",\"value\": \"@f1..value@\",\"source\": \"@rule..source@\",\"description\": \"@rule..description@\",\"level\": \"@rule..level@\"}"},{"name":"Pipe_0_MQTTPub.PublishData","type":"string","value":"{ \"id\": \"@f1..id@\", \"source\": \"@f1..source@\", \"device\": \"@f1..device@\", \"gateway\": \"@f1..gateway@\", \"readings\": [{\"id\": \"@f1..id@\", \"origin\": \"@f1..origin@\", \"device\": \"@f1..device@\", \"name\": \"@f1..name@\", \"value\": \"@f1..value@\", \"valueType\": \"@f1..valueType@\", \"mediaType\": \"@f1..mediaType@\"}]}"},{"name":"Pipe_0_MQTTPub.TargetField","type":"string","value":"f1..value"},{"name":"Pipe_0_MQTTPub.EscapeDoubleQuote","type":"boolean","value":true},{"name":"Pipe_0_MQTTPub.EncodeReadingValue","type":"boolean","value":false},{"name":"Pipe_0_App.IsListener","type":"boolean","value":false},{"name":"Pipe_1_Logging.LogLevel","type":"string","value":"INFO"},{"name":"Pipe_1_MQTTPub.Topic","type":"string","value":"AIRModelScoredData"},{"name":"Pipe_1_MQTTPub.Qos","type":"float64","value":2},{"name":"Pipe_1_MQTTPub.KeepAlive","type":"float64","value":120},{"name":"Pipe_1_MQTTPub.CleanSession","type":"boolean","value":false},{"name":"Pipe_1_MQTTPub.Retain","type":"boolean","value":false},{"name":"Pipe_1_MQTTPub.Store","type":"string","value":""},{"name":"Mqtt.Pipe_1_IoTMQTT.Broker_URL","type":"string","value":"tcp://a0056dbbadb2f11e99e4c067e42b309c-335014729.us-west-2.elb.amazonaws.com:1883"},{"name":"Mqtt.Pipe_1_IoTMQTT.Username","type":"string","value":"mqtt_admin"},{"name":"Mqtt.Pipe_1_IoTMQTT.Password","type":"string","value":"SECRET:w73f6dRNWmzKm4xSRB0yRg=="},{"name":"Pipe_1_App.ComponentName","type":"string","value":"Pipe_1"},{"name":"App.NotificationListeners","type":"string","value":"[]"},{"name":"Pipe_1_MQTTPub.NotificationData","type":"string","value":"{\"uuid\": \"@f1..id@\",\"created\": \"@f1..origin@\",\"gateway\": \"@f1..gateway@\",\"device\": \"@f1..device@\",\"resource\": \"@f1..name@\",\"value\": \"@f1..value@\",\"source\": \"@rule..source@\",\"description\": \"@rule..description@\",\"level\": \"@rule..level@\"}"},{"name":"Pipe_1_MQTTPub.PublishData","type":"string","value":"{ \"id\": \"@f1..id@\", \"source\": \"@f1..source@\", \"device\": \"@f1..device@\", \"gateway\": \"@f1..gateway@\", \"readings\": [{\"id\": \"@f1..id@\", \"origin\": \"@f1..origin@\", \"device\": \"@f1..device@\", \"name\": \"@f1..name@\", \"value\": \"@f1..value@\", \"valueType\": \"@f1..valueType@\", \"mediaType\": \"@f1..mediaType@\"}]}"},{"name":"Pipe_1_MQTTPub.TargetField","type":"string","value":"f1..value"},{"name":"Pipe_1_MQTTPub.EscapeDoubleQuote","type":"boolean","value":true},{"name":"Pipe_1_MQTTPub.EncodeReadingValue","type":"boolean","value":false},{"name":"Pipe_1_App.IsListener","type":"boolean","value":false},{"name":"Logging.LogLevel","type":"string","value":"INFO"},{"name":"Filter_2_App.ComponentName","type":"string","value":"Filter_2"},{"name":"Filter_2_App.IsListener","type":"boolean","value":false},{"name":"Logging.LogLevel","type":"string","value":"INFO"},{"name":"Filter_3_App.ComponentName","type":"string","value":"Filter_3"},{"name":"Filter_3_App.IsListener","type":"boolean","value":false}],"resources":[{"data":{"description":"","links":[{"from":"Log","id":1,"to":"DeserializePayload","type":"default"},{"from":"DeserializePayload","id":2,"to":"ReadingLog","type":"default"},{"from":"ReadingLog","id":3,"to":"NewFlowData","type":"default"},{"from":"NewFlowData","id":4,"to":"Next_Flow","type":"default"},{"from":"Next_Flow","id":5,"to":"Return","type":"default"}],"metadata":{"fe_metadata":{"input":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"data\":{\"type\":\"object\",\"properties\":{\"Checksum\":{\"type\":\"string\"},\"CorrelationID\":{\"type\":\"string\"},\"Payload\":{\"type\":\"string\"},\"ContentType\":{\"type\":\"string\"}}}}}"},"input":[{"name":"data","schema":{"type":"json","value":"{\"Checksum\":{\"type\":\"string\"},\"CorrelationID\":{\"type\":\"string\"},\"Payload\":{\"type\":\"string\"},\"ContentType\":{\"type\":\"string\"}}"},"type":"object"}],"output":[]},"name":"DataSource","tasks":[{"activity":{"input":{"Log Level":"=$property[\"DataSource_Logging.LogLevel\"]","flowInfo":false,"message":"=string.concat(\"########## DataSource ##########\", coerce.toString($flow.data))"},"ref":"#log"},"description":"Simple Log Message Activity","id":"Log","name":"Log"},{"activity":{"input":{"JSONString":"=air.ternary($property[\"DataSource_Data.DecodePayload\"], coerce.toString(utils.decodeBase64($flow.data.Payload)), $flow.data.Payload)"},"ref":"#jsondeserializer","schemas":{"output":{"Data":{"fe_metadata":"{\"gateway\":\"g-001\",\"readings\":[{\"id\":\"2157df0c-6d57-4e3a-b77f-a1e39ae2e88a\",\"origin\":1614030300929,\"device\":\"versicharge-0001\",\"name\":\"Voltage\",\"value\":\"218.0\",\"valueType\":\"String\",\"mediaType\":\"\"}]}","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"gateway\":{\"type\":\"string\"},\"readings\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"id\":{\"type\":\"string\"},\"origin\":{\"type\":\"number\"},\"device\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"valueType\":{\"type\":\"string\"},\"mediaType\":{\"type\":\"string\"}}}}}}"}},"settings":{"dataSample":{"fe_metadata":"{\"gateway\":\"g-001\",\"readings\":[{\"id\":\"2157df0c-6d57-4e3a-b77f-a1e39ae2e88a\",\"origin\":1614030300929,\"device\":\"versicharge-0001\",\"name\":\"Voltage\",\"value\":\"218.0\",\"valueType\":\"String\",\"mediaType\":\"\"}]}","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"gateway\":{\"type\":\"string\"},\"readings\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"id\":{\"type\":\"string\"},\"origin\":{\"type\":\"number\"},\"device\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"valueType\":{\"type\":\"string\"},\"mediaType\":{\"type\":\"string\"}}}}}}"}}},"settings":{"dataSample":{"fe_metadata":"{\"gateway\":\"g-001\",\"readings\":[{\"id\":\"2157df0c-6d57-4e3a-b77f-a1e39ae2e88a\",\"origin\":1614030300929,\"device\":\"versicharge-0001\",\"name\":\"Voltage\",\"value\":\"218.0\",\"valueType\":\"String\",\"mediaType\":\"\"}]}","metadata":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"gateway\":{\"type\":\"string\"},\"readings\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"id\":{\"type\":\"string\"},\"origin\":{\"type\":\"number\"},\"device\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"valueType\":{\"type\":\"string\"},\"mediaType\":{\"type\":\"string\"}}}}}}","value":""},"defaultValue":"","sample":"","schemaFromfile":false}},"description":"JSON Deserializer Activity","id":"DeserializePayload","name":"DeserializePayload"},{"activity":{"input":{"Log Level":"=$property[\"DataSource_Logging.LogLevel\"]","flowInfo":false,"message":"=string.concat(\"########## DataSource:Payload ##########\", coerce.toString($activity[DeserializePayload].Data))"},"ref":"#log"},"description":"Simple Log Message Activity","id":"ReadingLog","name":"ReadingLog"},{"activity":{"input":{"Mapping":{"mapping":{"SkipCondition":"=false","enriched":[],"gateway":"=$property[\"DataSource_Data.Gateway\"]","readings":"=$activity[DeserializePayload].Data.readings"}}},"ref":"#mapping","schemas":{"input":{"Mapping":{"fe_metadata":"{\"gateway\":\"2\",\"readings\":[],\"enriched\":[],\"SkipCondition\":false}","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"gateway\":{\"type\":\"string\"},\"readings\":{\"type\":\"array\",\"items\":{}},\"enriched\":{\"type\":\"array\",\"items\":{}},\"SkipCondition\":{\"type\":\"boolean\"}}}"}},"output":{"Data":{"fe_metadata":"{\"gateway\":\"2\",\"readings\":[],\"enriched\":[]}","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"gateway\":{\"type\":\"string\"},\"readings\":{\"type\":\"array\",\"items\":{}},\"enriched\":{\"type\":\"array\",\"items\":{}}}}"}},"settings":{"MappingFields":{"fe_metadata":"[{\"Name\":\"gateway\",\"Type\":\"String\"},{\"Name\":\"readings\",\"Type\":\"Array\"},{\"Name\":\"enriched\",\"Type\":\"Array\"}]","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Name\":{\"type\":\"string\"},\"Type\":{\"type\":\"string\"}},\"required\":[\"Name\",\"Type\"]}}"}}},"settings":{"IsArray":false,"MappingFields":"[{\"Name\":\"gateway\",\"Type\":\"String\"},{\"Name\":\"readings\",\"Type\":\"Array\"},{\"Name\":\"enriched\",\"Type\":\"Array\"}]"}},"description":"Mapping field from input to output","id":"NewFlowData","name":"NewFlowData"},{"activity":{"input":{"enriched":"=$activity[NewFlowData].Data.enriched","gateway":"=$activity[NewFlowData].Data.gateway","reading":"=$iteration[value]"},"ref":"#subflow","schemas":{"input":{"input":{"type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"gateway\":{\"type\":\"string\"},\"reading\":{\"type\":\"object\",\"properties\":{\"id\":{\"type\":\"string\"},\"origin\":{\"type\":\"number\"},\"device\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"valueType\":{\"type\":\"string\"},\"mediaType\":{\"type\":\"string\"}}},\"enriched\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"producer\":{\"type\":\"string\"},\"consumer\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"}}}}}}"}}},"settings":{"flowURI":"res://flow:Pipe_0"}},"description":"Simple SubFlow Activity","id":"Next_Flow","name":"Next_Flow","settings":{"accumulate":false,"iterate":"=$activity[NewFlowData].Data.readings"},"type":"iterator"},{"activity":{"ref":"#actreturn"},"description":"Simple Return Activity","id":"Return","name":"Return"}]},"id":"flow:DataSource"},{"data":{"description":"7|14","links":[{"from":"Log","id":1,"to":"CheckServiceType","type":"default"},{"from":"CheckServiceType","id":2,"label":"CheckServiceTypeto","to":"LogPublish","type":"expression","value":"false==$activity[CheckServiceType].Data.IsNotificationListener\u0026\u0026false==$activity[CheckServiceType].Data.IsNotification"},{"from":"LogPublish","id":3,"to":"DataSelector","type":"default"},{"from":"DataSelector","id":4,"to":"TransformData","type":"default"},{"from":"TransformData","id":5,"to":"SerializerData","type":"default"},{"from":"SerializerData","id":6,"to":"MQTTPub","type":"default"},{"from":"MQTTPub","id":7,"to":"Next_Flow_7","type":"default"},{"from":"Next_Flow_7","id":8,"to":"Return1","type":"default"},{"from":"CheckServiceType","id":9,"label":"CheckServiceTypetoLogMessage1","to":"LogNotification","type":"expression","value":"true==$activity[CheckServiceType].Data.IsNotificationListener\u0026\u0026true==$activity[CheckServiceType].Data.IsNotification"},{"from":"LogNotification","id":10,"label":"LogNotificationtoMQTTPub1","to":"MQTTNotify","type":"expression","value":"\"Message\"==$flow.enriched[0].value"},{"from":"MQTTNotify","id":11,"to":"Return2","type":"default"},{"from":"LogNotification","id":12,"label":"LogNotificationtoReturn","to":"Return3","type":"exprOtherwise"},{"from":"CheckServiceType","id":13,"label":"CheckServiceType to LogMessage1","to":"LogPassThrough","type":"exprOtherwise"},{"from":"LogPassThrough","id":14,"to":"Next_Flow_14","type":"default"},{"from":"Next_Flow_14","id":15,"to":"Return4","type":"default"}],"metadata":{"fe_metadata":{"input":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"gateway\":{\"type\":\"string\"},\"reading\":{\"type\":\"object\",\"properties\":{\"id\":{\"type\":\"string\"},\"origin\":{\"type\":\"number\"},\"device\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"valueType\":{\"type\":\"string\"},\"mediaType\":{\"type\":\"string\"}}},\"enriched\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"producer\":{\"type\":\"string\"},\"consumer\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"}}}}}}"},"input":[{"name":"gateway","type":"string"},{"name":"reading","schema":{"type":"json","value":"{\"id\":{\"type\":\"string\"},\"origin\":{\"type\":\"number\"},\"device\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"valueType\":{\"type\":\"string\"},\"mediaType\":{\"type\":\"string\"}}"},"type":"object"},{"name":"enriched","schema":{"type":"json","value":"{\"type\":\"object\",\"properties\":{\"producer\":{\"type\":\"string\"},\"consumer\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"}}}"},"type":"array"}],"output":[]},"name":"Pipe_0","tasks":[{"activity":{"input":{"Log Level":"=$property[\"Pipe_0_Logging.LogLevel\"]","flowInfo":false,"message":"=string.concat(\"########## Pipe_0(MQTT_FS) ########## : gateway = \", $flow.gateway, \", reading = { ... }, enriched = \", coerce.toString($flow.enriched))"},"ref":"#log"},"description":"Simple Log Message Activity","id":"Log","name":"Log"},{"activity":{"input":{"Mapping":{"mapping":{"IsNotification":"=(0\u003carray.count($flow.enriched)) \u0026\u0026 (\"Notification\"==$flow.enriched[0].name)","IsNotificationListener":"=$property[\"Pipe_0_App.IsListener\"]"}}},"ref":"#mapping","schemas":{"input":{"Mapping":{"fe_metadata":"{\"IsNotificationListener\":true,\"IsNotification\":true,\"SkipCondition\":false}","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"IsNotificationListener\":{\"type\":\"boolean\"},\"IsNotification\":{\"type\":\"boolean\"},\"SkipCondition\":{\"type\":\"boolean\"}}}"}},"output":{"Data":{"fe_metadata":"{\"IsNotificationListener\":true,\"IsNotification\":true}","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"IsNotificationListener\":{\"type\":\"boolean\"},\"IsNotification\":{\"type\":\"boolean\"}}}"}},"settings":{"MappingFields":{"fe_metadata":"[{\"Name\":\"IsNotificationListener\",\"Type\":\"Boolean\"},{\"Name\":\"IsNotification\",\"Type\":\"Boolean\"}]","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Name\":{\"type\":\"string\"},\"Type\":{\"type\":\"string\"}},\"required\":[\"Name\",\"Type\"]}}"}}},"settings":{"IsArray":false,"MappingFields":"[{\"Name\":\"IsNotificationListener\",\"Type\":\"Boolean\"},{\"Name\":\"IsNotification\",\"Type\":\"Boolean\"}]"}},"description":"Mapping field from input to output","id":"CheckServiceType","name":"CheckServiceType"},{"activity":{"input":{"Log Level":"INFO","flowInfo":false,"message":"*** Publishing ***"},"ref":"#log"},"description":"Simple Log Message Activity","id":"LogPublish","name":"LogPublish"},{"activity":{"input":{"DataCollection":"=air.airdata2collection(air.modifyobject(air.modifyobject(air.json2object(\"{}\"), \"gateway\", $flow.gateway), \"reading\", $flow.reading), $flow.enriched)","Variables":{"mapping":{"Value":"=$property[\"Pipe_0_MQTTPub.TargetField\"]"}}},"ref":"#dataselector","schemas":{"input":{"Variables":{"fe_metadata":"{\"Value\":\"2\"}","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"Value\":{\"type\":\"string\"}}}"}},"output":{"ExtractedData":{"fe_metadata":"{\"Value\":\"2\"}","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"Value\":{\"type\":\"string\"}}}"}},"settings":{"targets":{"fe_metadata":"[{\"Name\":\"Value\",\"FieldMatch\":\"$Value$\",\"Type\":\"String\"}]","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Name\":{\"type\":\"string\"},\"FieldMatch\":{\"type\":\"string\"},\"Type\":{\"type\":\"string\"}}}}"},"variablesDef":{"fe_metadata":"[{\"Name\":\"Value\",\"Type\":\"String\"}]","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Name\":{\"type\":\"string\"},\"Type\":{\"type\":\"string\"}}}}"}}},"settings":{"leftToken":"$","rightToken":"$","targets":"[{\"Name\":\"Value\",\"FieldMatch\":\"$Value$\",\"Type\":\"String\"}]","variablesDef":"[{\"Name\":\"Value\",\"Type\":\"String\"}]"}},"description":"This activity select datas from array","id":"DataSelector","name":"DataSelector"},{"activity":{"input":{"Mapping":{"mapping":{"ResourceID":"=air.ternary(\"f1..value\"==$property[\"Pipe_0_MQTTPub.TargetField\"], $flow.reading.id, string.concat($flow.reading.id, \"_\", string.substring($property[\"Pipe_0_MQTTPub.TargetField\"],string.lastIndex($property[\"Pipe_0_MQTTPub.TargetField\"], \".\")+1,string.len($property[\"Pipe_0_MQTTPub.TargetField\"])-string.lastIndex($property[\"Pipe_0_MQTTPub.TargetField\"], \".\")-1)))","ResourceName":"=air.ternary(\"f1..value\"==$property[\"Pipe_0_MQTTPub.TargetField\"], $flow.reading.name, string.concat($flow.reading.name, \"_\", string.substring($property[\"Pipe_0_MQTTPub.TargetField\"],string.lastIndex($property[\"Pipe_0_MQTTPub.TargetField\"], \".\")+1,string.len($property[\"Pipe_0_MQTTPub.TargetField\"])-string.lastIndex($property[\"Pipe_0_MQTTPub.TargetField\"], \".\")-1)))"}}},"ref":"#mapping","schemas":{"input":{"Mapping":{"fe_metadata":"{\"ResourceID\":\"2\",\"ResourceName\":\"2\",\"SkipCondition\":false}","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"ResourceID\":{\"type\":\"string\"},\"ResourceName\":{\"type\":\"string\"},\"SkipCondition\":{\"type\":\"boolean\"}}}"}},"output":{"Data":{"fe_metadata":"{\"ResourceID\":\"2\",\"ResourceName\":\"2\"}","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"ResourceID\":{\"type\":\"string\"},\"ResourceName\":{\"type\":\"string\"}}}"}},"settings":{"MappingFields":{"fe_metadata":"[{\"Name\":\"ResourceID\",\"Type\":\"String\"},{\"Name\":\"ResourceName\",\"Type\":\"String\"}]","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Name\":{\"type\":\"string\"},\"Type\":{\"type\":\"string\"}},\"required\":[\"Name\",\"Type\"]}}"}}},"settings":{"IsArray":false,"MappingFields":"[{\"Name\":\"ResourceID\",\"Type\":\"String\"},{\"Name\":\"ResourceName\",\"Type\":\"String\"}]"}},"description":"Mapping field from input to output","id":"TransformData","name":"TransformData"},{"activity":{"input":{"Data":{"mapping":{"device":"=$flow.reading.device","gateway":"=$flow.gateway","id":"=$activity[TransformData].Data.ResourceID","readings":[{"device":"=$flow.reading.device","id":"=$activity[TransformData].Data.ResourceID","mediaType":"=$flow.reading.mediaType","name":"=$activity[TransformData].Data.ResourceName","origin":"=$flow.reading.origin","value":"=air.ternary($property[\"Pipe_0_MQTTPub.EncodeReadingValue\"], air.tobase64string($activity[DataSelector].ExtractedData.Value), $activity[DataSelector].ExtractedData.Value)","valueType":"=$flow.reading.valueType"}],"source":"=$flow.reading.origin"}}},"ref":"#jsonserializer","schemas":{"input":{"Data":{"fe_metadata":"{\"id\":\"@f1..id@\",\"source\":1,\"device\":\"@f1..device@\",\"gateway\":\"@f1..gateway@\",\"readings\":[{\"id\":\"@f1..id@\",\"origin\":1,\"device\":\"@f1..device@\",\"name\":\"@f1..name@\",\"value\":\"@f1..value@\",\"valueType\":\"@f1..valueType@\",\"mediaType\":\"@f1..mediaType@\"}]}","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"id\":{\"type\":\"string\"},\"source\":{\"type\":\"number\"},\"device\":{\"type\":\"string\"},\"gateway\":{\"type\":\"string\"},\"readings\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"id\":{\"type\":\"string\"},\"origin\":{\"type\":\"number\"},\"device\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"valueType\":{\"type\":\"string\"},\"mediaType\":{\"type\":\"string\"}}}}}}"}},"settings":{"dataSample":{"fe_metadata":"{ \"id\": \"@f1..id@\", \"source\": 1, \"device\": \"@f1..device@\", \"gateway\": \"@f1..gateway@\", \"readings\": [{\"id\": \"@f1..id@\", \"origin\": 1, \"device\": \"@f1..device@\", \"name\": \"@f1..name@\", \"value\": \"@f1..value@\", \"valueType\": \"@f1..valueType@\", \"mediaType\": \"@f1..mediaType@\"}]}","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"id\":{\"type\":\"string\"},\"source\":{\"type\":\"number\"},\"device\":{\"type\":\"string\"},\"gateway\":{\"type\":\"string\"},\"readings\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"id\":{\"type\":\"string\"},\"origin\":{\"type\":\"number\"},\"device\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"valueType\":{\"type\":\"string\"},\"mediaType\":{\"type\":\"string\"}}}}}}"}}},"settings":{"dataSample":{"fe_metadata":"{ \"id\": \"@f1..id@\", \"source\": 1, \"device\": \"@f1..device@\", \"gateway\": \"@f1..gateway@\", \"readings\": [{\"id\": \"@f1..id@\", \"origin\": 1, \"device\": \"@f1..device@\", \"name\": \"@f1..name@\", \"value\": \"@f1..value@\", \"valueType\": \"@f1..valueType@\", \"mediaType\": \"@f1..mediaType@\"}]}","metadata":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"id\":{\"type\":\"string\"},\"source\":{\"type\":\"number\"},\"device\":{\"type\":\"string\"},\"gateway\":{\"type\":\"string\"},\"readings\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"id\":{\"type\":\"string\"},\"origin\":{\"type\":\"number\"},\"device\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"valueType\":{\"type\":\"string\"},\"mediaType\":{\"type\":\"string\"}}}}}}","value":""},"sample":"","schemaFromfile":false}},"description":"JSON Serializer Activity","id":"SerializerData","name":"SerializerData"},{"activity":{"input":{"message":"=$activity[SerializerData].JSONString"},"ref":"github.com/SteveNY-Tibco/labs-air-contrib/activity/mqtt","settings":{"broker":"=$property[\"Mqtt.Pipe_0_IoTMQTT.Broker_URL\"]","cleanSession":"=$property[\"Pipe_0_MQTTPub.CleanSession\"]","id":"=string.concat(\"Pipe_0_MQTTPub_\", utils.uuid())","keepAlive":"=$property[\"Pipe_0_MQTTPub.KeepAlive\"]","password":"=$property[\"Mqtt.Pipe_0_IoTMQTT.Password\"]","qos":"=$property[\"Pipe_0_MQTTPub.Qos\"]","retain":"=$property[\"Pipe_0_MQTTPub.Retain\"]","topic":"=$property[\"Pipe_0_MQTTPub.Topic\"]","username":"=$property[\"Mqtt.Pipe_0_IoTMQTT.Username\"]"}},"description":"An MQTT message publisher","id":"MQTTPub","name":"MQTTPub"},{"activity":{"input":{"enriched":"=$flow.enriched","gateway":"=$flow.gateway","reading":"=$flow.reading"},"ref":"#subflow","schemas":{"input":{"input":{"type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"gateway\":{\"type\":\"string\"},\"reading\":{\"type\":\"object\",\"properties\":{\"id\":{\"type\":\"string\"},\"origin\":{\"type\":\"number\"},\"device\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"valueType\":{\"type\":\"string\"},\"mediaType\":{\"type\":\"string\"}}},\"enriched\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"producer\":{\"type\":\"string\"},\"consumer\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"}}}}}}"}}},"settings":{"flowURI":"res://flow:Pipe_1"}},"description":"Simple SubFlow Activity","id":"Next_Flow_7","name":"Next_Flow_7"},{"activity":{"ref":"#actreturn"},"description":"Simple Return Activity","id":"Return1","name":"Return1"},{"activity":{"input":{"Log Level":"INFO","flowInfo":false,"message":"*** Notifying ***"},"ref":"#log"},"description":"Simple Log Message Activity","id":"LogNotification","name":"LogNotification"},{"activity":{"input":{"message":"=air.airdataselector($flow.gateway, $flow.reading, $flow.enriched, $property[\"Pipe_0_MQTTPub.NotificationData\"])"},"ref":"github.com/SteveNY-Tibco/labs-air-contrib/activity/mqtt","settings":{"broker":"=$property[\"Mqtt.Pipe_0_IoTMQTT.Broker_URL\"]","cleanSession":"=$property[\"Pipe_0_MQTTPub.CleanSession\"]","id":"=string.concat(\"Pipe_0_MQTTNotify\", utils.uuid())","keepAlive":"=$property[\"Pipe_0_MQTTPub.KeepAlive\"]","password":"=$property[\"Mqtt.Pipe_0_IoTMQTT.Password\"]","qos":"=$property[\"Pipe_0_MQTTPub.Qos\"]","retain":"=$property[\"Pipe_0_MQTTPub.Retain\"]","topic":"=$property[\"Pipe_0_MQTTPub.Topic\"]","username":"=$property[\"Mqtt.Pipe_0_IoTMQTT.Username\"]"}},"description":"An MQTT message publisher","id":"MQTTNotify","name":"MQTTNotify"},{"activity":{"ref":"#actreturn"},"description":"Simple Return Activity","id":"Return2","name":"Return2"},{"activity":{"ref":"#actreturn"},"description":"Simple Return Activity","id":"Return3","name":"Return3"},{"activity":{"input":{"Log Level":"INFO","flowInfo":false,"message":"*** Passing Through ***"},"ref":"#log"},"description":"Simple Log Message Activity","id":"LogPassThrough","name":"LogPassThrough"},{"activity":{"input":{"enriched":"=$flow.enriched","gateway":"=$flow.gateway","reading":"=$flow.reading"},"ref":"#subflow","schemas":{"input":{"input":{"type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"gateway\":{\"type\":\"string\"},\"reading\":{\"type\":\"object\",\"properties\":{\"id\":{\"type\":\"string\"},\"origin\":{\"type\":\"number\"},\"device\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"valueType\":{\"type\":\"string\"},\"mediaType\":{\"type\":\"string\"}}},\"enriched\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"producer\":{\"type\":\"string\"},\"consumer\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"}}}}}}"}}},"settings":{"flowURI":"res://flow:Pipe_1"}},"description":"Simple SubFlow Activity","id":"Next_Flow_14","name":"Next_Flow_14"},{"activity":{"ref":"#actreturn"},"description":"Simple Return Activity","id":"Return4","name":"Return4"}]},"id":"flow:Pipe_0"},{"data":{"description":"7|14","links":[{"from":"Log","id":1,"to":"CheckServiceType","type":"default"},{"from":"CheckServiceType","id":2,"label":"CheckServiceTypeto","to":"LogPublish","type":"expression","value":"false==$activity[CheckServiceType].Data.IsNotificationListener\u0026\u0026false==$activity[CheckServiceType].Data.IsNotification"},{"from":"LogPublish","id":3,"to":"DataSelector","type":"default"},{"from":"DataSelector","id":4,"to":"TransformData","type":"default"},{"from":"TransformData","id":5,"to":"SerializerData","type":"default"},{"from":"SerializerData","id":6,"to":"MQTTPub","type":"default"},{"from":"MQTTPub","id":7,"to":"Next_Flow_7","type":"default"},{"from":"Next_Flow_7","id":8,"to":"Return1","type":"default"},{"from":"CheckServiceType","id":9,"label":"CheckServiceTypetoLogMessage1","to":"LogNotification","type":"expression","value":"true==$activity[CheckServiceType].Data.IsNotificationListener\u0026\u0026true==$activity[CheckServiceType].Data.IsNotification"},{"from":"LogNotification","id":10,"label":"LogNotificationtoMQTTPub1","to":"MQTTNotify","type":"expression","value":"\"Message\"==$flow.enriched[0].value"},{"from":"MQTTNotify","id":11,"to":"Return2","type":"default"},{"from":"LogNotification","id":12,"label":"LogNotificationtoReturn","to":"Return3","type":"exprOtherwise"},{"from":"CheckServiceType","id":13,"label":"CheckServiceType to LogMessage1","to":"LogPassThrough","type":"exprOtherwise"},{"from":"LogPassThrough","id":14,"to":"Next_Flow_14","type":"default"},{"from":"Next_Flow_14","id":15,"to":"Return4","type":"default"}],"metadata":{"fe_metadata":{"input":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"gateway\":{\"type\":\"string\"},\"reading\":{\"type\":\"object\",\"properties\":{\"id\":{\"type\":\"string\"},\"origin\":{\"type\":\"number\"},\"device\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"valueType\":{\"type\":\"string\"},\"mediaType\":{\"type\":\"string\"}}},\"enriched\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"producer\":{\"type\":\"string\"},\"consumer\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"}}}}}}"},"input":[{"name":"gateway","type":"string"},{"name":"reading","schema":{"type":"json","value":"{\"id\":{\"type\":\"string\"},\"origin\":{\"type\":\"number\"},\"device\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"valueType\":{\"type\":\"string\"},\"mediaType\":{\"type\":\"string\"}}"},"type":"object"},{"name":"enriched","schema":{"type":"json","value":"{\"type\":\"object\",\"properties\":{\"producer\":{\"type\":\"string\"},\"consumer\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"}}}"},"type":"array"}],"output":[]},"name":"Pipe_1","tasks":[{"activity":{"input":{"Log Level":"=$property[\"Pipe_1_Logging.LogLevel\"]","flowInfo":false,"message":"=string.concat(\"########## Pipe_1(MQTT_FS) ########## : gateway = \", $flow.gateway, \", reading = { ... }, enriched = \", coerce.toString($flow.enriched))"},"ref":"#log"},"description":"Simple Log Message Activity","id":"Log","name":"Log"},{"activity":{"input":{"Mapping":{"mapping":{"IsNotification":"=(0\u003carray.count($flow.enriched)) \u0026\u0026 (\"Notification\"==$flow.enriched[0].name)","IsNotificationListener":"=$property[\"Pipe_1_App.IsListener\"]"}}},"ref":"#mapping","schemas":{"input":{"Mapping":{"fe_metadata":"{\"IsNotificationListener\":true,\"IsNotification\":true,\"SkipCondition\":false}","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"IsNotificationListener\":{\"type\":\"boolean\"},\"IsNotification\":{\"type\":\"boolean\"},\"SkipCondition\":{\"type\":\"boolean\"}}}"}},"output":{"Data":{"fe_metadata":"{\"IsNotificationListener\":true,\"IsNotification\":true}","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"IsNotificationListener\":{\"type\":\"boolean\"},\"IsNotification\":{\"type\":\"boolean\"}}}"}},"settings":{"MappingFields":{"fe_metadata":"[{\"Name\":\"IsNotificationListener\",\"Type\":\"Boolean\"},{\"Name\":\"IsNotification\",\"Type\":\"Boolean\"}]","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Name\":{\"type\":\"string\"},\"Type\":{\"type\":\"string\"}},\"required\":[\"Name\",\"Type\"]}}"}}},"settings":{"IsArray":false,"MappingFields":"[{\"Name\":\"IsNotificationListener\",\"Type\":\"Boolean\"},{\"Name\":\"IsNotification\",\"Type\":\"Boolean\"}]"}},"description":"Mapping field from input to output","id":"CheckServiceType","name":"CheckServiceType"},{"activity":{"input":{"Log Level":"INFO","flowInfo":false,"message":"*** Publishing ***"},"ref":"#log"},"description":"Simple Log Message Activity","id":"LogPublish","name":"LogPublish"},{"activity":{"input":{"DataCollection":"=air.airdata2collection(air.modifyobject(air.modifyobject(air.json2object(\"{}\"), \"gateway\", $flow.gateway), \"reading\", $flow.reading), $flow.enriched)","Variables":{"mapping":{"Value":"=$property[\"Pipe_1_MQTTPub.TargetField\"]"}}},"ref":"#dataselector","schemas":{"input":{"Variables":{"fe_metadata":"{\"Value\":\"2\"}","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"Value\":{\"type\":\"string\"}}}"}},"output":{"ExtractedData":{"fe_metadata":"{\"Value\":\"2\"}","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"Value\":{\"type\":\"string\"}}}"}},"settings":{"targets":{"fe_metadata":"[{\"Name\":\"Value\",\"FieldMatch\":\"$Value$\",\"Type\":\"String\"}]","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Name\":{\"type\":\"string\"},\"FieldMatch\":{\"type\":\"string\"},\"Type\":{\"type\":\"string\"}}}}"},"variablesDef":{"fe_metadata":"[{\"Name\":\"Value\",\"Type\":\"String\"}]","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Name\":{\"type\":\"string\"},\"Type\":{\"type\":\"string\"}}}}"}}},"settings":{"leftToken":"$","rightToken":"$","targets":"[{\"Name\":\"Value\",\"FieldMatch\":\"$Value$\",\"Type\":\"String\"}]","variablesDef":"[{\"Name\":\"Value\",\"Type\":\"String\"}]"}},"description":"This activity select datas from array","id":"DataSelector","name":"DataSelector"},{"activity":{"input":{"Mapping":{"mapping":{"ResourceID":"=air.ternary(\"f1..value\"==$property[\"Pipe_1_MQTTPub.TargetField\"], $flow.reading.id, string.concat($flow.reading.id, \"_\", string.substring($property[\"Pipe_1_MQTTPub.TargetField\"],string.lastIndex($property[\"Pipe_1_MQTTPub.TargetField\"], \".\")+1,string.len($property[\"Pipe_1_MQTTPub.TargetField\"])-string.lastIndex($property[\"Pipe_1_MQTTPub.TargetField\"], \".\")-1)))","ResourceName":"=air.ternary(\"f1..value\"==$property[\"Pipe_1_MQTTPub.TargetField\"], $flow.reading.name, string.concat($flow.reading.name, \"_\", string.substring($property[\"Pipe_1_MQTTPub.TargetField\"],string.lastIndex($property[\"Pipe_1_MQTTPub.TargetField\"], \".\")+1,string.len($property[\"Pipe_1_MQTTPub.TargetField\"])-string.lastIndex($property[\"Pipe_1_MQTTPub.TargetField\"], \".\")-1)))"}}},"ref":"#mapping","schemas":{"input":{"Mapping":{"fe_metadata":"{\"ResourceID\":\"2\",\"ResourceName\":\"2\",\"SkipCondition\":false}","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"ResourceID\":{\"type\":\"string\"},\"ResourceName\":{\"type\":\"string\"},\"SkipCondition\":{\"type\":\"boolean\"}}}"}},"output":{"Data":{"fe_metadata":"{\"ResourceID\":\"2\",\"ResourceName\":\"2\"}","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"ResourceID\":{\"type\":\"string\"},\"ResourceName\":{\"type\":\"string\"}}}"}},"settings":{"MappingFields":{"fe_metadata":"[{\"Name\":\"ResourceID\",\"Type\":\"String\"},{\"Name\":\"ResourceName\",\"Type\":\"String\"}]","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"Name\":{\"type\":\"string\"},\"Type\":{\"type\":\"string\"}},\"required\":[\"Name\",\"Type\"]}}"}}},"settings":{"IsArray":false,"MappingFields":"[{\"Name\":\"ResourceID\",\"Type\":\"String\"},{\"Name\":\"ResourceName\",\"Type\":\"String\"}]"}},"description":"Mapping field from input to output","id":"TransformData","name":"TransformData"},{"activity":{"input":{"Data":{"mapping":{"device":"=$flow.reading.device","gateway":"=$flow.gateway","id":"=$activity[TransformData].Data.ResourceID","readings":[{"device":"=$flow.reading.device","id":"=$activity[TransformData].Data.ResourceID","mediaType":"=$flow.reading.mediaType","name":"=$activity[TransformData].Data.ResourceName","origin":"=$flow.reading.origin","value":"=air.ternary($property[\"Pipe_1_MQTTPub.EncodeReadingValue\"], air.tobase64string($activity[DataSelector].ExtractedData.Value), $activity[DataSelector].ExtractedData.Value)","valueType":"=$flow.reading.valueType"}],"source":"=$flow.reading.origin"}}},"ref":"#jsonserializer","schemas":{"input":{"Data":{"fe_metadata":"{\"id\":\"@f1..id@\",\"source\":1,\"device\":\"@f1..device@\",\"gateway\":\"@f1..gateway@\",\"readings\":[{\"id\":\"@f1..id@\",\"origin\":1,\"device\":\"@f1..device@\",\"name\":\"@f1..name@\",\"value\":\"@f1..value@\",\"valueType\":\"@f1..valueType@\",\"mediaType\":\"@f1..mediaType@\"}]}","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"id\":{\"type\":\"string\"},\"source\":{\"type\":\"number\"},\"device\":{\"type\":\"string\"},\"gateway\":{\"type\":\"string\"},\"readings\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"id\":{\"type\":\"string\"},\"origin\":{\"type\":\"number\"},\"device\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"valueType\":{\"type\":\"string\"},\"mediaType\":{\"type\":\"string\"}}}}}}"}},"settings":{"dataSample":{"fe_metadata":"{ \"id\": \"@f1..id@\", \"source\": 1, \"device\": \"@f1..device@\", \"gateway\": \"@f1..gateway@\", \"readings\": [{\"id\": \"@f1..id@\", \"origin\": 1, \"device\": \"@f1..device@\", \"name\": \"@f1..name@\", \"value\": \"@f1..value@\", \"valueType\": \"@f1..valueType@\", \"mediaType\": \"@f1..mediaType@\"}]}","type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"id\":{\"type\":\"string\"},\"source\":{\"type\":\"number\"},\"device\":{\"type\":\"string\"},\"gateway\":{\"type\":\"string\"},\"readings\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"id\":{\"type\":\"string\"},\"origin\":{\"type\":\"number\"},\"device\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"valueType\":{\"type\":\"string\"},\"mediaType\":{\"type\":\"string\"}}}}}}"}}},"settings":{"dataSample":{"fe_metadata":"{ \"id\": \"@f1..id@\", \"source\": 1, \"device\": \"@f1..device@\", \"gateway\": \"@f1..gateway@\", \"readings\": [{\"id\": \"@f1..id@\", \"origin\": 1, \"device\": \"@f1..device@\", \"name\": \"@f1..name@\", \"value\": \"@f1..value@\", \"valueType\": \"@f1..valueType@\", \"mediaType\": \"@f1..mediaType@\"}]}","metadata":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"id\":{\"type\":\"string\"},\"source\":{\"type\":\"number\"},\"device\":{\"type\":\"string\"},\"gateway\":{\"type\":\"string\"},\"readings\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"id\":{\"type\":\"string\"},\"origin\":{\"type\":\"number\"},\"device\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"valueType\":{\"type\":\"string\"},\"mediaType\":{\"type\":\"string\"}}}}}}","value":""},"sample":"","schemaFromfile":false}},"description":"JSON Serializer Activity","id":"SerializerData","name":"SerializerData"},{"activity":{"input":{"message":"=$activity[SerializerData].JSONString"},"ref":"github.com/SteveNY-Tibco/labs-air-contrib/activity/mqtt","settings":{"broker":"=$property[\"Mqtt.Pipe_1_IoTMQTT.Broker_URL\"]","cleanSession":"=$property[\"Pipe_1_MQTTPub.CleanSession\"]","id":"=string.concat(\"Pipe_1_MQTTPub_\", utils.uuid())","keepAlive":"=$property[\"Pipe_1_MQTTPub.KeepAlive\"]","password":"=$property[\"Mqtt.Pipe_1_IoTMQTT.Password\"]","qos":"=$property[\"Pipe_1_MQTTPub.Qos\"]","retain":"=$property[\"Pipe_1_MQTTPub.Retain\"]","topic":"=$property[\"Pipe_1_MQTTPub.Topic\"]","username":"=$property[\"Mqtt.Pipe_1_IoTMQTT.Username\"]"}},"description":"An MQTT message publisher","id":"MQTTPub","name":"MQTTPub"},{"activity":{"input":{"enriched":"=$flow.enriched","gateway":"=$flow.gateway","reading":"=$flow.reading"},"ref":"#subflow","schemas":{"input":{"input":{"type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"gateway\":{\"type\":\"string\"},\"reading\":{\"type\":\"object\",\"properties\":{\"id\":{\"type\":\"string\"},\"origin\":{\"type\":\"number\"},\"device\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"valueType\":{\"type\":\"string\"},\"mediaType\":{\"type\":\"string\"}}},\"enriched\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"producer\":{\"type\":\"string\"},\"consumer\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"}}}}}}"}}},"settings":{"flowURI":"res://flow:Filter_2"}},"description":"Simple SubFlow Activity","id":"Next_Flow_7","name":"Next_Flow_7"},{"activity":{"ref":"#actreturn"},"description":"Simple Return Activity","id":"Return1","name":"Return1"},{"activity":{"input":{"Log Level":"INFO","flowInfo":false,"message":"*** Notifying ***"},"ref":"#log"},"description":"Simple Log Message Activity","id":"LogNotification","name":"LogNotification"},{"activity":{"input":{"message":"=air.airdataselector($flow.gateway, $flow.reading, $flow.enriched, $property[\"Pipe_1_MQTTPub.NotificationData\"])"},"ref":"github.com/SteveNY-Tibco/labs-air-contrib/activity/mqtt","settings":{"broker":"=$property[\"Mqtt.Pipe_1_IoTMQTT.Broker_URL\"]","cleanSession":"=$property[\"Pipe_1_MQTTPub.CleanSession\"]","id":"=string.concat(\"Pipe_1_MQTTNotify\", utils.uuid())","keepAlive":"=$property[\"Pipe_1_MQTTPub.KeepAlive\"]","password":"=$property[\"Mqtt.Pipe_1_IoTMQTT.Password\"]","qos":"=$property[\"Pipe_1_MQTTPub.Qos\"]","retain":"=$property[\"Pipe_1_MQTTPub.Retain\"]","topic":"=$property[\"Pipe_1_MQTTPub.Topic\"]","username":"=$property[\"Mqtt.Pipe_1_IoTMQTT.Username\"]"}},"description":"An MQTT message publisher","id":"MQTTNotify","name":"MQTTNotify"},{"activity":{"ref":"#actreturn"},"description":"Simple Return Activity","id":"Return2","name":"Return2"},{"activity":{"ref":"#actreturn"},"description":"Simple Return Activity","id":"Return3","name":"Return3"},{"activity":{"input":{"Log Level":"INFO","flowInfo":false,"message":"*** Passing Through ***"},"ref":"#log"},"description":"Simple Log Message Activity","id":"LogPassThrough","name":"LogPassThrough"},{"activity":{"input":{"enriched":"=$flow.enriched","gateway":"=$flow.gateway","reading":"=$flow.reading"},"ref":"#subflow","schemas":{"input":{"input":{"type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"gateway\":{\"type\":\"string\"},\"reading\":{\"type\":\"object\",\"properties\":{\"id\":{\"type\":\"string\"},\"origin\":{\"type\":\"number\"},\"device\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"valueType\":{\"type\":\"string\"},\"mediaType\":{\"type\":\"string\"}}},\"enriched\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"producer\":{\"type\":\"string\"},\"consumer\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"}}}}}}"}}},"settings":{"flowURI":"res://flow:Filter_2"}},"description":"Simple SubFlow Activity","id":"Next_Flow_14","name":"Next_Flow_14"},{"activity":{"ref":"#actreturn"},"description":"Simple Return Activity","id":"Return4","name":"Return4"}]},"id":"flow:Pipe_1"},{"data":{"description":"","links":[{"from":"Log","id":1,"to":"Next_Flow","type":"default"},{"from":"Next_Flow","id":2,"to":"Return","type":"default"}],"metadata":{"input":[{"name":"gateway","type":"string"},{"name":"reading","schema":{"type":"json","value":"{\"id\":{\"type\":\"string\"},\"origin\":{\"type\":\"number\"},\"device\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"valueType\":{\"type\":\"string\"},\"mediaType\":{\"type\":\"string\"}}"},"type":"object"},{"name":"enriched","schema":{"type":"json","value":"{\"type\":\"object\",\"properties\":{\"producer\":{\"type\":\"string\"},\"consumer\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"}}}"},"type":"array"}],"output":[]},"name":"Filter_2","tasks":[{"activity":{"input":{"addDetails":false,"message":"########## Aggregate ##########"},"ref":"#log"},"description":"Logs a message","id":"Log","name":"Log"},{"activity":{"input":{"enriched":"=$flow.enriched","gateway":"=$flow.gateway","reading":"=$flow.reading"},"ref":"#subflow","schemas":{"input":{"input":{"type":"json","value":"{\"$schema\":\"http://json-schema.org/draft-04/schema#\",\"type\":\"object\",\"properties\":{\"gateway\":{\"type\":\"string\"},\"reading\":{\"type\":\"object\",\"properties\":{\"id\":{\"type\":\"string\"},\"origin\":{\"type\":\"number\"},\"device\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"valueType\":{\"type\":\"string\"},\"mediaType\":{\"type\":\"string\"}}},\"enriched\":{\"type\":\"array\",\"items\":{\"type\":\"object\",\"properties\":{\"producer\":{\"type\":\"string\"},\"consumer\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"}}}}}}"}}},"settings":{"flowURI":"res://flow:Filter_3"}},"description":"Simple SubFlow Activity","id":"Next_Flow","name":"Next_Flow"},{"activity":{"ref":"#actreturn"},"description":"Simple Return Activity","id":"Return","name":"Return"}]},"id":"flow:Filter_2"},{"data":{"description":"","links":[{"from":"Log","id":1,"to":"Return","type":"default"}],"metadata":{"input":[{"name":"gateway","type":"string"},{"name":"reading","schema":{"type":"json","value":"{\"id\":{\"type\":\"string\"},\"origin\":{\"type\":\"number\"},\"device\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"valueType\":{\"type\":\"string\"},\"mediaType\":{\"type\":\"string\"}}"},"type":"object"},{"name":"enriched","schema":{"type":"json","value":"{\"type\":\"object\",\"properties\":{\"producer\":{\"type\":\"string\"},\"consumer\":{\"type\":\"string\"},\"name\":{\"type\":\"string\"},\"value\":{\"type\":\"string\"},\"type\":{\"type\":\"string\"}}}"},"type":"array"}],"output":[]},"name":"Filter_3","tasks":[{"activity":{"input":{"addDetails":false,"message":"########## Aggregate ##########"},"ref":"#log"},"description":"Logs a message","id":"Log","name":"Log"},{"activity":{"ref":"#actreturn"},"description":"Simple Return Activity","id":"Return","name":"Return"}]},"id":"flow:Filter_3"}],"triggers":[{"description":"Subscribe to an MQTT topic","handlers":[{"action":{"input":{"data":"=$.content","topic":"=$.topic"},"ref":"github.com/project-flogo/flow","settings":{"flowURI":"res://flow:DataSource"}},"description":"","name":"DataSource","settings":{"deserializer":"=$property[\"DataSource_MQTTTrigger.Deserializer\"]","qos":"=$property[\"DataSource_MQTTTrigger.MaximumQOS\"]","topic":"=$property[\"DataSource_MQTTTrigger.Topic\"]"}}],"id":"MQTTSubscriber","name":"mqtt-trigger","ref":"github.com/SteveNY-Tibco/labs-air-contrib/trigger/mqtt","settings":{"autoReconnect":"=$property[\"Mqtt.DataSource_IoTMQTT.AutoReconnect\"]","broker":"=$property[\"Mqtt.DataSource_IoTMQTT.Broker_URL\"]","cleanSession":"=$property[\"Mqtt.DataSource_IoTMQTT.CleanSession\"]","id":"=string.concat(\"DataSource_IoTMQTT\", utils.uuid())","keepAlive":"=$property[\"Mqtt.DataSource_IoTMQTT.KeepAlive\"]","password":"=$property[\"Mqtt.DataSource_IoTMQTT.Password\"]","store":"=$property[\"Mqtt.DataSource_IoTMQTT.Store\"]","username":"=$property[\"Mqtt.DataSource_IoTMQTT.Username\"]"}}],"type":"flogo:app","version":"1.0.0"}